<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Emergency Doctor Simulator</title>

  <!-- CSS CRÍTICO (evita “tela branca crua” se o CSS externo falhar) -->
  <style>
    :root { color-scheme: dark; }
    html, body { height: 100%; }
    body {
      margin: 0;
      background: #0b0f1a;
      color: #eaeef7;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
    }
    #app { min-height: 100vh; }
    .hidden { display: none !important; }
  </style>

  <!-- IMPORTANTE: use ./ para GitHub Pages na raiz -->
  <link rel="stylesheet" href="./style.css?v=1" />

  <!-- PWA -->
  <link rel="manifest" href="./manifest.json" />
  <meta name="theme-color" content="#0b1225" />
</head>

<body>
<div id="app">

  <!-- TOP BAR -->
  <header class="topbar">
    <div>
      <strong>Emergency Doctor Simulator</strong><br />
      <small>Simulador educacional de pronto-socorro</small>
    </div>
    <div class="topbar-actions">
      <button class="btn" onclick="toggleFullscreen()">Tela cheia</button>
      <button class="btn" onclick="openHelp()">Ajuda</button>
      <button class="btn" onclick="openRanking()">Ranking</button>
    </div>
  </header>

  <main class="stage">

    <!-- HOME -->
    <section class="screen active" id="screen-home">
      <div class="screen-bg" style="background-image:url('./images/cover.png')"></div>
      <div class="screen-content">
        <div class="panel" style="max-width:560px">
          <div class="panel-body">
            <h1>EMERGENCY DOCTOR SIMULATOR</h1>
            <p>Tome decisões clínicas, solicite exames e conduza casos simulados.</p>
            <p><strong>Aviso:</strong> Simulação educacional. Não substitui atendimento médico real.</p>

            <div class="row-actions">
              <button class="btn primary" onclick="startNewGame()">Novo Jogo</button>
              <button class="btn" onclick="continueGame()">Continuar</button>
              <button class="btn ghost" onclick="installPWA()">Instalar (PWA)</button>
            </div>

            <p class="muted small">
              Upgrade AAA ativo: Plantão (10 casos), streak de acertos e eventos aleatórios (superlotação, falta de leito/equipamento/insumo).
            </p>
          </div>
        </div>
      </div>
    </section>

    <!-- PERFIL -->
    <section class="screen" id="screen-profile">
      <div class="screen-bg" style="background-image:url('./images/fundo.jpg')"></div>
      <div class="screen-content">
        <div class="panel" style="width:100%;max-width:900px;margin:auto">
          <div class="panel-header">
            <strong>Perfil do Doutor</strong>
          </div>

          <div class="panel-body">
            <label>Seu nome</label>
            <input id="doctorName" placeholder="Ex: Dr(a). Jonatan" />

            <h3 style="margin-top:16px">Escolha um avatar</h3>
            <div class="action-grid" id="avatarGrid"></div>
          </div>

          <div class="panel-footer">
            <button class="btn" onclick="goHome()">Voltar</button>
            <button class="btn primary" onclick="confirmProfile()">Confirmar</button>
          </div>
        </div>
      </div>
    </section>

    <!-- CONSULTÓRIO -->
    <section class="screen" id="screen-office">
      <div class="screen-bg" style="background-image:url('./images/consultorio.jpg')"></div>

      <div class="screen-content office-layout">
        <aside class="panel hud">
          <div class="panel-body hud-card">
            <img id="doctorAvatar" alt="Avatar" />
            <p id="doctorInfo"></p>

            <div class="hud-stats">
              <div>Pontos: <span id="points">0</span></div>
              <div>Casos: <span id="casesDone">0</span></div>
              <div>Prestígio: <span id="prestige">0</span></div>
              <div>Erros: <span id="mistakes">0</span></div>
              <div>Acertos: <span id="hits">0</span></div>

              <div class="shift-row">
                <div><strong>Plantão</strong></div>
                <div id="shiftStatus" class="shift-pill">Inativo</div>
              </div>
              <div class="shift-row">
                <div>Progresso:</div>
                <div><span id="shiftProg">0</span>/<span id="shiftTarget">10</span></div>
              </div>
              <div class="shift-row">
                <div>Streak:</div>
                <div><span id="shiftStreak">0</span> (Best: <span id="shiftBest">0</span>)</div>
              </div>
            </div>

            <div class="hud-actions">
              <button class="btn primary" onclick="startShift(10)">Iniciar Plantão (10)</button>
              <button class="btn" onclick="endShift()">Encerrar Plantão</button>
              <button class="btn" onclick="nextCase()">Próximo Caso</button>
            </div>
          </div>
        </aside>

        <section class="panel">
          <div class="panel-body">
            <h2>Consultório de Emergência</h2>
            <p>Atenda pacientes, solicite exames e tome decisões clínicas.</p>
            <p><strong>AAA:</strong> Plantão + streak + eventos dinâmicos impactam tempo, pressão e pontuação.</p>
            <p>Novos casos entram apenas em <code>cases.json</code>.</p>
          </div>
        </section>
      </div>
    </section>

    <!-- ATENDIMENTO -->
    <section class="screen" id="screen-case">
      <div class="screen-bg" id="caseBg"></div>

      <!-- HUD FIXO DO CASO -->
      <div class="case-hud">
        <div class="case-hud-item">
          <strong>Tempo do Caso</strong>
          <div><span id="caseTime">00:00</span> / <span id="caseLimit">00:00</span></div>
        </div>
        <div class="case-hud-item">
          <strong>Pressão</strong>
          <div class="pressure-bar">
            <div class="pressure-fill" id="pressureFill"></div>
          </div>
          <small id="pressureLabel">Baixa</small>
        </div>
        <div class="case-hud-item">
          <strong>Triagem</strong>
          <div id="triageBadge" class="triage-badge"></div>
        </div>
        <div class="case-hud-item" style="min-width:260px">
          <strong>Evento do Plantão</strong>
          <div id="eventLabel" class="muted">Nenhum</div>
          <small id="eventEffect" class="muted">—</small>
        </div>
      </div>

      <div class="screen-content case-layout">

        <!-- PACIENTE -->
        <section class="panel case-left">
          <div class="panel-header">
            <strong id="patientName"></strong>
            <span class="muted small" id="patientMeta"></span>
          </div>
          <div class="panel-body">
            <img id="patientPhoto" alt="Paciente" />
            <p><strong>Queixa:</strong> <span id="patientComplaint"></span></p>
            <p><strong>História:</strong> <span id="patientHistory"></span></p>

            <h4>Sinais Vitais</h4>
            <ul id="vitalsList"></ul>
          </div>
        </section>

        <!-- AÇÕES -->
        <section class="panel">
          <div class="panel-header">
            <strong>Perguntas & Exames</strong>
          </div>
          <div class="panel-body">
            <h4>Perguntas</h4>
            <div id="questionsArea"></div>

            <h4>Solicitar Exames (todos)</h4>
            <div class="action-grid" id="examsArea"></div>

            <div id="examResultsArea"></div>
          </div>
        </section>

        <!-- DECISÃO -->
        <section class="panel case-right">
          <div class="panel-header">
            <strong>Decisão Clínica</strong>
          </div>
          <div class="panel-body">
            <h4>Diagnóstico (escolha 1)</h4>
            <div class="action-grid" id="diagnosisArea"></div>

            <h4>Conduta / Medicação (até 2)</h4>
            <div class="action-grid" id="medicationsArea"></div>
          </div>
          <div class="panel-footer">
            <button class="btn primary" onclick="finalizeCase()">Finalizar Atendimento</button>
          </div>
        </section>

      </div>
    </section>

  </main>
</div>

<!-- RANKING OVERLAY -->
<div class="overlay hidden" id="rankOverlay">
  <div class="overlay-backdrop" onclick="closeRanking()"></div>
  <div class="overlay-card">
    <div class="panel-header">
      <strong>Ranking (Top 10)</strong>
      <button class="btn" onclick="closeRanking()">Fechar</button>
    </div>
    <div class="overlay-card-body" id="rankBody"></div>
  </div>
</div>

<script src="./script.js"></script>
</body>
</html>
